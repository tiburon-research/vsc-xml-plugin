# Настройка

### Общая настройка VSCode

Настройки открываются так: `Файл -> Параметры -> Параметры`

Это список пользовательских параметров в формате JSON. Чтобы настройки работали всегда и везде, а не только в текущей рабочей области, надо убедиться в том, что (в правом верхнем углу) выбраны `Параметры пользователя`, а не `Параметры рабочей области`.

* **Привязка файлов**

    Чтобы расширение применялось ко всем XML-файлам необходимо указать для них язык `tib`. За это отвечает параметр `files.associations`:
    ```JSON
    "files.associations": {"*.xml": "tib"}
    ```
    Язык для любого файла можно поменять в нижнем правом углу, но это одноразовое изменение - в следующий раз файл откроется в соответствии с настройками.
    
* **Автозавершение**

  Большинство используемых слов встроено в расширение, но VSC может сам предлагать варианты автозавершения на основе слов из редактируемого файла. Если это мешает, то отключается вот так:
  ```JSON
  "editor.wordBasedSuggestions": false
  ```
  
 * **Кодировка файла**
    
   Чтобы VSC пытался сам определить кодировку файла нужно включить
   ```JSON
   "files.autoGuessEncoding": true
   ```
* **Символы согласия с предложением**
  
  По умолчанию предложение автозавершения принимается не только клавишей `Tab`, но и `Enter`. Это не всегда удобно. Отключается вот так:
  ```JSON
  "editor.acceptSuggestionOnEnter": "off"
  ```


# Функционал

### Подсветка синтаксиса

Внутри XML распознаётся:
* **C#**
  * Внутри тегов Redirect, Filter, Validate и Methods;
  * в кодовых вставках `[c#][/c#]`;
  * в сторчных методах `$method()`.
* **CSS**
  * внутри тега `<style>`
  * внутри `style=""`
* **JavaScript**
  * внутри тега `<script>`

### XML шаблоны (Snippets)

При вводе расширение предлагает имеющиеся шаблоны (например, Page, Question и т.д.), которые принимаются нажатием клавиши `Tab`. Каждое следующее нажатие `Tab` перемещает курсор к следующей позиции, где предполагается ввод.

![Image](https://github.com/tiburon-research/vsc-xml-plugin/blob/master/stuff/PageSnippet.gif?raw=true)

### Кроме структуры XML предусмотрены следующие шаблоны:
* Сворачивающийся блок
```xml
  <!--#block Тестирование упаковок -->

    <Page Id="Q1">
    ...
    </Page>
  
  <!--#endBlock-->
```

* Путь для материалов: после ввода `src="` расширение предлагает подставить путь `src="@StoreUrl/t/tib_####"/` с номером проекта из имени файла.

# Особенности

### Условия в `<Item>` вместо C#-кода

Если вместо C# используются условные `<Item Page="" Question="" Answer=""/>`, то во избежание коллапса подсветки после тега (например `<Redirect>`) необходимо поставить пробел или табуляцию на той же строке. В этом случае текст внутри будет подсвечен, как обычный `XML`.